# 開発ルール

## ブランチ戦略

### ブランチ命名規則
- **パターン**: `feature/{番号}-{機能概要}`
- **例**: `feature/5-user-registration`
- **ルール**: 
  - 英小文字のみ使用
  - 単語区切りは ハイフン(-)
  - 日本語禁止
  - Issue番号から直接対応関係が分かるようにする

### ブランチフロー
```
main ブランチ
├── feature/1-setup-project
├── feature/2-book-entity
├── feature/3-book-repository
├── feature/4-book-service
└── feature/5-user-registration
```

### ブランチ運用ルール
1. **main ブランチ**: 常にデプロイ可能な状態を維持
2. **feature ブランチ**: 各Issue毎に作成
3. **sourceブランチ**: 基本的にmain
4. **マージ**: プルリクエスト経由のみ
5. **削除**: マージ後は速やかにfeatureブランチを削除

---

## コミット規則

### コミットメッセージ規則
```
#{番号} {種別}: {概要}

例:
#5 feat: ユーザー登録機能を追加
#5 fix: バリデーションエラーを修正
#5 docs: README にセットアップ手順を追加
#5 test: ユーザー登録のテストケースを追加
#5 refactor: UserService のコード整理
```

### コミット種別
| 種別 | 用途 | 例 |
|------|------|-----|
| `feat` | 新機能追加 | #5 feat: ユーザー登録API追加 |
| `fix` | バグ修正 | #5 fix: バリデーションエラー修正 |
| `docs` | ドキュメント更新 | #5 docs: API仕様書更新 |
| `test` | テスト追加・修正 | #5 test: ユーザー登録テスト追加 |
| `refactor` | リファクタリング | #5 refactor: Service層の整理 |
| `style` | フォーマット修正 | #5 style: Google Java Format適用 |
| `chore` | ビルド・設定変更 | #5 chore: Gradle依存関係更新 |

### コミット運用ルール
1. **1コミット1機能**: 小さな単位でコミット
2. **指摘対応**: 1指摘対応につき1コミット、レビューコメントにコミットハッシュを記載
3. **作業途中**: 随時プッシュしてプルリクエストを作成・更新
4. **日本語**: コミットメッセージは日本語で分かりやすく記述

---

## プルリクエスト規則

### 基本ルール
- **1 Issue = 1 PR**: 1つのIssueに対して1つのプルリクエスト
- **レビュー必須**: 最低1名のレビュー・承認が必要
- **セルフマージ禁止**: 作成者以外がマージを実行
- **conflict解決**: 作成者が責任を持って解決

### マージ前チェック項目
#### Phase 1-2（初期段階）
- [ ] **ビルド成功**: `.\gradlew.bat build` が成功すること
- [ ] **動作確認**: Talend API Tester での手動テスト完了
- [ ] **フォーマット確認**: Google Java Format が適用されていること
- [ ] **Javadoc確認**: public/protectedメソッドにJavadocが記載されていること

#### Phase 3以降（テスト導入後）
- [ ] **単体テスト成功**: `.\gradlew.bat test` が成功すること
- [ ] **テストカバレッジ**: 新規作成コードのテストが含まれていること
- [ ] **統合テスト**: 関連機能との連携テストが完了していること
- [ ] **CI/CDパス**: 自動化されたテスト・ビルドが成功すること

### プルリクエストテンプレート
```markdown
## 概要
Issue #XX の対応

## 変更内容
- [ ] 機能追加: XXXX
- [ ] バグ修正: XXXX
- [ ] テスト追加: XXXX

## 動作確認
- [ ] ローカル環境での動作確認完了
- [ ] Talend API Tester でのAPIテスト完了
- [ ] 単体テストの実行確認（Phase 3以降）

## レビューポイント
- XXXX について重点的に確認をお願いします
- XXXX の実装方針について意見をお聞かせください

## 関連Issue
- Closes #XX
```

---

## コーディング規約

### 命名規則
| 対象 | 規則 | 例 |
|------|------|-----|
| **クラス名** | PascalCase | `BookController`, `UserService` |
| **メソッド名** | camelCase | `findById`, `createUser` |
| **変数名** | camelCase | `userId`, `bookList` |
| **定数名** | UPPER_SNAKE_CASE | `MAX_LOAN_DAYS`, `DEFAULT_PAGE_SIZE` |
| **パッケージ名** | 小文字+ピリオド | `com.example.library.controller` |

### フォーマット規則
- **Google Java Format**: 必須適用
- **インデント**: スペース2文字
- **改行コード**: LF（Gitで自動変換）
- **文字エンコーディング**: UTF-8

### ドキュメント規則
- **Javadoc**: public/protectedメソッドに必須
- **コメント**: 複雑なロジックには日本語コメントを記載
- **TODO**: 一時的な実装には `// TODO: 説明` を記載

### Javadoc テンプレート
```java
/**
 * 書籍情報を登録します。
 * 
 * @param request 書籍登録リクエスト
 * @return 登録された書籍情報
 * @throws ValidationException 入力値が不正な場合
 * @throws BusinessException 業務ルール違反の場合
 */
public BookResponse createBook(BookCreateRequest request) {
    // 実装
}
```

---

## ファイル・フォルダ規則

### Java ファイル
- **パッケージ構成**: レイヤードアーキテクチャに従う
- **1クラス1ファイル**: 内部クラス以外は分離
- **ファイル名**: クラス名と一致

### SQL ファイル
- **命名規則**: `{番号}_{概要}.sql`
- **例**: `01_create_tables.sql`, `02_insert_master_data.sql`
- **文字コード**: UTF-8
- **改行コード**: LF

### 設定ファイル
- **application.yml**: 階層構造で整理
- **プロファイル分離**: 環境別（dev/prod）に分離
- **機密情報**: 環境変数で管理、直接記載禁止

---

## Issue 管理

### Issue 作成ルール
1. **事前作成**: 作業開始前に必ずIssueを作成
2. **1Issue1機能**: 1つのIssueは1つの機能・修正に対応
3. **明確な説明**: 何を、なぜ、どのように行うかを明記
4. **受け入れ条件**: 完了の定義を明確にする

### Issue テンプレート
```markdown
## 概要
XXX機能を実装する

## 背景・目的
- なぜこの機能が必要か
- どのような価値を提供するか

## 受け入れ条件
- [ ] 条件1
- [ ] 条件2
- [ ] 条件3

## 実装方針
- 技術的な実装方針
- 参考資料や設計方針

## 備考
- 注意事項
- 関連するIssue
```

### ラベル管理
| ラベル | 用途 |
|--------|------|
| `enhancement` | 新機能追加 |
| `bug` | バグ修正 |
| `documentation` | ドキュメント更新 |
| `question` | 質問・相談 |
| `in progress` | 作業中 |
| `review` | レビュー中 |
| `done` | 完了 |

---

## レビューガイドライン

### レビューポイント

#### 技術面
1. **コードの可読性**
   - 命名規則の遵守
   - 適切なコメント
   - 理解しやすい構造

2. **設計パターンの適用**
   - MVC パターンの適切な適用
   - DI（依存性注入）の活用
   - レイヤードアーキテクチャの遵守

3. **セキュリティ対策**
   - SQLインジェクション対策
   - 入力値検証の実装
   - 認証・認可の考慮

4. **パフォーマンス**
   - N+1問題の回避
   - 適切なインデックス活用
   - 不要なデータ取得の排除

5. **テスト品質**
   - カバレッジの充足
   - 境界値テストの実装
   - 異常系テストの考慮

#### プロセス面
1. **Git の適切な活用**
   - コミット粒度の適切さ
   - ブランチ戦略の遵守
   - コミットメッセージの明確さ

2. **コミュニケーション**
   - 指摘への適切な対応
   - 疑問点の積極的な質問
   - 建設的な議論

3. **ドキュメント**
   - README の更新
   - API仕様書の整備
   - 設計書の作成・更新

### レビュアーの心得
- **建設的なフィードバック**: 改善提案を含める
- **教育的視点**: 理由も含めて説明
- **迅速なレスポンス**: 24時間以内の初回レスポンス
- **肯定的な評価**: 良い実装には積極的に評価

### レビュイーの心得
- **事前セルフチェック**: 自分でまず確認
- **説明の充実**: プルリクエストの詳細な説明
- **積極的な質問**: 不明点は遠慮なく質問
- **感謝の気持ち**: レビューへの感謝を忘れずに

---

## 開発フロー

### 日常の開発フロー
1. **Issue確認**: 作業対象のIssueを確認
2. **ブランチ作成**: `feature/{番号}-{概要}` で作成
3. **実装**: 小刻みにコミット・プッシュ
4. **プルリクエスト作成**: 早期に作成、WIPでも可
5. **レビュー**: レビューを受けて修正
6. **マージ**: レビュー承認後にマージ
7. **ブランチ削除**: マージ後に削除

### 困った時の相談フロー
1. **自己解決を試行**: まず自分で調査・検討
2. **Issue コメント**: Issue に状況をコメント
3. **相談**: メンターや先輩に相談
4. **記録**: 解決方法をドキュメント化

---

## 品質管理

### 継続的改善
- **振り返り**: 各Phase終了時に振り返り実施
- **ルール見直し**: 必要に応じてルールを更新
- **知見共有**: 学んだことを積極的に共有

### 技術的負債の管理
- **定期的なリファクタリング**: 計画的に実施
- **TODO の管理**: 定期的にTODOを見直し
- **依存関係の更新**: セキュリティアップデート等を適用

---

## 参考資料
- [Google Java Style Guide](https://google.github.io/styleguide/javaguide.html)
- [Spring Boot Reference Documentation](https://spring.io/projects/spring-boot)
- [GitHub Flow](https://guides.github.com/introduction/flow/)
- [Conventional Commits](https://www.conventionalcommits.org/ja/v1.0.0/)