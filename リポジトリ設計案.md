# 研修用リポジトリ設計案

## 開発対象アプリケーション：「図書館管理システム」

### なぜ図書館管理システムか
1. **理解しやすいドメイン** - 誰でも図書館の仕組みを知っている
2. **段階的な機能拡張が可能** - 基本機能から高度な機能まで自然に発展
3. **現実的なビジネスロジック** - 実務に近い要件を学習可能
4. **CRUD操作の網羅** - 基本的なデータベース操作をすべて学習

---

## アプリケーション機能仕様

### Phase 1: 基本機能
- **書籍管理** - 書籍の登録・更新・削除・検索
- **利用者管理** - 利用者の登録・更新・削除
- **貸出管理** - 書籍の貸出・返却
- **基本検索** - タイトル・著者による検索

### Phase 2: 中級機能
- **予約機能** - 貸出中書籍の予約
- **延長機能** - 貸出期間の延長
- **履歴管理** - 貸出履歴の管理
- **在庫管理** - 複数冊管理

### Phase 3: 高度な機能
- **レポート機能** - 貸出統計・人気書籍ランキング
- **通知機能** - 返却期限通知・予約完了通知
- **API機能** - REST API の提供
- **認証・認可** - ユーザー権限管理

---

## 技術スタック

### バックエンド
- **Java 17** + **Spring Boot 3.x**
- **Spring Data JPA** - データアクセス
- **PostgreSQL** - メインデータベース（MySQL 対応も可能）
- **Spring Security** - 認証・認可
- **Spring Boot Test** - テスト

### API テストツール
- **Talend API Tester** - API リクエスト送信・テスト

### 開発ツール
- **Gradle** - ビルドツール
- **JUnit 5** - テスト
- **Google Java Format** - コードフォーマット

---

## 開発ルール（改良版）

### 1. ブランチ戦略
```
main ブランチ
├── feature/issue-1-setup-project
├── feature/issue-2-book-entity
├── feature/issue-3-book-repository
└── feature/issue-4-book-service
```

### 2. ブランチ命名規則
- **パターン**: `feature/issue-{番号}-{機能概要}`
- **例**: `feature/issue-5-user-registration`
- **ルール**: 
  - 英小文字のみ
  - 単語区切りは ハイフン(-)
  - 日本語禁止

### 3. コミットメッセージ規則
```
[Issue #{番号}] {種別}: {概要}

例:
[Issue #5] feat: ユーザー登録機能を追加
[Issue #5] fix: バリデーションエラーを修正
[Issue #5] docs: README にセットアップ手順を追加
```

**コミット種別**:
- `feat`: 新機能
- `fix`: バグ修正
- `docs`: ドキュメント
- `test`: テスト追加・修正
- `refactor`: リファクタリング

### 4. プルリクエストルール
- **1 Issue = 1 PR**
- **レビュー必須** (最低1名)
- **CI/CD パス必須**
- **conflict解決は作成者が対応**

### 5. コーディング規約
- **Google Java Format** 必須
- **Javadoc** をpublic/protectedメソッドに必須
- **インデント**: スペース2文字
- **変数名**: camelCase
- **定数名**: UPPER_SNAKE_CASE

---

## 開発環境セットアップ手順

### 1. Gradle プロジェクト設定

#### build.gradle 例
```groovy
plugins {
    id 'java'
    id 'org.springframework.boot' version '3.2.0'
    id 'io.spring.dependency-management' version '1.1.4'
}

group = 'com.example'
version = '0.0.1-SNAPSHOT'

java {
    sourceCompatibility = '17'
}

configurations {
    compileOnly {
        extendsFrom annotationProcessor
    }
}

repositories {
    mavenCentral()
}

dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-validation'
    implementation 'org.springframework.boot:spring-boot-starter-security'
    
    // Database
    runtimeOnly 'org.postgresql:postgresql'
    
    // Development
    developmentOnly 'org.springframework.boot:spring-boot-devtools'
    
    // Documentation
    implementation 'org.springdoc:springdoc-openapi-starter-webmvc-ui:2.2.0'
    
    // Testing
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testImplementation 'org.springframework.security:spring-security-test'
    testImplementation 'org.testcontainers:junit-jupiter'
    testImplementation 'org.testcontainers:postgresql'
    
    // Annotation Processing
    annotationProcessor 'org.springframework.boot:spring-boot-configuration-processor'
}

tasks.named('test') {
    useJUnitPlatform()
}

// Gradle タスク例
task generateApi {
    doLast {
        println 'API ドキュメント生成中...'
    }
}
```

### 2. 基本的な Gradle コマンド
```bash
# プロジェクトビルド
./gradlew build

# アプリケーション実行
./gradlew bootRun

# テスト実行
./gradlew test

# 依存関係確認
./gradlew dependencies

# タスク一覧表示
./gradlew tasks

# クリーンビルド
./gradlew clean build
```

### 3. PostgreSQL 環境構築（Docker使用）
```yaml
# docker-compose.yml
version: '3.8'
services:
  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: library_system
      POSTGRES_USER: dev_user
      POSTGRES_PASSWORD: dev_password
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./sql:/docker-entrypoint-initdb.d
volumes:
  postgres_data:
```

### 4. application.yml 設定例
```yaml
spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/library_system
    username: dev_user
    password: dev_password
    driver-class-name: org.postgresql.Driver
  jpa:
    hibernate:
      ddl-auto: create-drop  # 開発時のみ
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
```

### 5. MySQL 対応時の変更点
```yaml
# MySQL使用時の設定例
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/library_system
    username: dev_user
    password: dev_password
    driver-class-name: com.mysql.cj.jdbc.Driver
  jpa:
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQLDialect
```

---

## Issue 設計（学習順序）

### Phase 1: 環境構築・基盤 (Issue #1-10)

#### Issue #1: プロジェクト初期設定
**目的**: Spring Boot プロジェクト・Gradle の基本構造理解
```
- Spring Boot プロジェクト作成（Spring Initializr）
- Gradle 設定ファイル（build.gradle）理解
- 基本的な依存関係設定
- Gradle タスクの基本操作
- application.yml 設定
- プロジェクト構造の理解
- README.md 作成
```

#### Issue #2: PostgreSQL データベース設定
**目的**: PostgreSQL・JPA設定の理解
```
- PostgreSQL データベース作成
- Docker Compose で PostgreSQL 環境構築
- application.yml でデータベース接続設定
- JPA 設定（DDL auto, naming strategy等）
- 初期データ投入スクリプト（data.sql）作成
```

#### Issue #3: Book エンティティ作成
**目的**: JPA エンティティの基本理解
```
- Book エンティティクラス作成
- アノテーション設定 (@Entity, @Id, @Column)
- バリデーション設定
```

#### Issue #4: Book Repository 作成
**目的**: Spring Data JPA の理解
```
- JpaRepository を継承した Repository 作成
- 基本的なクエリメソッド実装
- カスタムクエリ作成
```

#### Issue #5: Book Service 作成
**目的**: ビジネスロジック層の理解
```
- Service クラス作成
- CRUD メソッド実装
- トランザクション設定
```

#### Issue #6: Book Controller 作成
**目的**: REST API の基本理解
```
- RestController 作成
- CRUD エンドポイント実装
- リクエスト/レスポンス DTO 作成
```

#### Issue #7: 基本的な単体テスト作成
**目的**: テスト駆動開発の基礎
```
- Repository テスト作成
- Service テスト作成
- Controller テスト作成
```

#### Issue #8: 例外ハンドリング実装
**目的**: エラー処理の理解
```
- カスタム例外クラス作成
- GlobalExceptionHandler 作成
- エラーレスポンス統一
```

#### Issue #9: バリデーション強化
**目的**: 入力値検証の理解
```
- Bean Validation 設定
- カスタムバリデーター作成
- エラーメッセージ国際化
```

#### Issue #10: API テスト・ドキュメント
**目的**: API 設計・テストの理解
```
- Swagger/OpenAPI 設定
- API ドキュメント自動生成
- Talend API Tester でのテストケース作成
- Postman Collection エクスポート
```

### Phase 2: 機能拡張 (Issue #11-20)

#### Issue #11: User エンティティ・機能作成
**目的**: 複数エンティティの関連理解
```
- User エンティティ作成
- User 関連機能実装
- Book との関連は未実装
```

#### Issue #12: 貸出機能（Loan エンティティ）
**目的**: エンティティ間の関連理解
```
- Loan エンティティ作成
- Book-User-Loan の関連設定
- 貸出API実装
```

#### Issue #13: 返却機能実装
**目的**: ビジネスロジックの複雑化対応
```
- 返却API実装
- 返却日の自動設定
- 貸出状態の更新
```

#### Issue #14: 検索機能強化
**目的**: 複雑なクエリの理解
```
- 複数条件検索
- 部分一致検索
- ページネーション実装
```

#### Issue #15: 予約機能実装
**目的**: より複雑なビジネスロジック
```
- Reservation エンティティ作成
- 予約API実装
- 貸出可能時の自動通知
```

### Phase 3: 高度な機能 (Issue #21-30)

#### Issue #21: 認証機能実装
**目的**: Spring Security の理解
```
- Spring Security 設定
- JWT トークン認証
- ユーザー認証API
```

#### Issue #22: 権限制御実装
**目的**: 認可の理解
```
- ロールベースアクセス制御
- メソッドレベルセキュリティ
- 管理者・一般ユーザー区分
```

#### Issue #23: 統計・レポート機能
**目的**: 集約クエリの理解
```
- 貸出統計API
- 人気書籍ランキング
- ユーザー別貸出履歴
```

#### Issue #24: 通知機能
**目的**: 非同期処理の理解
```
- 返却期限通知
- 予約完了通知
- メール送信機能
```

#### Issue #25: ファイルアップロード
**目的**: ファイル処理の理解
```
- 書籍画像アップロード
- CSV インポート/エクスポート
- ファイル管理API
```

### Phase 4: 高度なバックエンド機能・統合テスト (Issue #31-40)

#### Issue #31: API 統合テスト設計
**目的**: E2E テストの理解
```
- TestContainers を使用した統合テスト
- API シナリオテスト作成
- Talend API Tester での手動テスト手順書作成
```

#### Issue #32: パフォーマンステスト・Gradle最適化
**目的**: 性能を意識した開発・ビルド最適化
```
- JMeter を使用した負荷テスト
- データベースクエリ最適化
- N+1 問題の検出・解決
- Gradle ビルドキャッシュ活用
- 並列ビルド設定
- プロファイルベースビルド
```

#### Issue #33: デプロイメント設定・DB最適化
**目的**: 本番環境・データベース最適化への理解
```
- Docker コンテナ化（アプリ + PostgreSQL）
- docker-compose 設定
- 環境別設定管理（dev/prod）
- PostgreSQL パフォーマンス設定
- データベースインデックス設計
- MySQL 互換性確認（オプション）
```

#### Issue #34: モニタリング・ログ強化
**目的**: 運用監視の理解
```
- Actuator を使用したヘルスチェック
- メトリクス収集設定
- 構造化ログ実装
```

#### Issue #35: セキュリティ強化
**目的**: セキュリティベストプラクティス
```
- OWASP Top 10 対策
- セキュリティヘッダー設定
- 脆弱性スキャン実装
```

#### Issue #36: API バージョニング
**目的**: API 設計の発展
```
- API バージョン管理戦略
- 後方互換性の維持
- 廃止予定 API の管理
```

#### Issue #37: 大量データ処理・DB最適化
**目的**: PostgreSQL 特有の機能・スケーラビリティの理解
```
- PostgreSQL 特有機能活用（JSONB、配列型等）
- バッチ処理実装
- ページング最適化（OFFSET/LIMIT vs Cursor-based）
- パーティショニング設計
- EXPLAIN ANALYZE を使用したクエリ分析
- MySQL との性能・機能比較（オプション）
```

#### Issue #38: 外部 API 連携
**目的**: システム間連携の理解
```
- 外部 API クライアント実装
- 回復性パターン（Circuit Breaker）
- API レート制限対応
```

#### Issue #39: キャッシュ戦略
**目的**: パフォーマンス最適化
```
- Redis を使用したキャッシュ実装
- キャッシュ戦略設計
- キャッシュ無効化パターン
```

#### Issue #40: 最終的なリファクタリング
**目的**: コード品質の向上
```
- コードレビュー実施
- 技術的負債の解消
- 設計パターンの適用
```

---

## 評価・レビューポイント

### 技術面
1. **コードの可読性** - 命名規則・コメント・構造
2. **設計パターンの理解** - MVC・DI・レイヤードアーキテクチャ
3. **テストの品質** - カバレッジ・境界値テスト
4. **セキュリティ意識** - SQL インジェクション対策・認証
5. **パフォーマンス** - N+1問題・インデックス活用

### プロセス面
1. **Git の活用** - コミット粒度・ブランチ戦略
2. **コードレビュー** - 指摘対応・コミュニケーション
3. **ドキュメント** - README・API仕様書・設計書
4. **問題解決力** - エラー対応・調査能力
5. **学習姿勢** - 新技術への取り組み・質問力

---

## 研修期間目安

- **Phase 1** (基盤): 3-4週間
- **Phase 2** (機能拡張): 3-4週間  
- **Phase 3** (高度な機能): 4-5週間
- **Phase 4** (高度なバックエンド・統合): 3-4週間

**総期間**: 約3-4ヶ月（週3-4日稼働想定）

---

## API テスト手順書テンプレート（Talend API Tester用）

### 基本的なテストケース例

#### 1. 書籍登録 API テスト
```
Method: POST
URL: http://localhost:8080/api/books
Headers: Content-Type: application/json
Body:
{
  "title": "Java入門",
  "author": "田中太郎", 
  "isbn": "978-4-1234-5678-9",
  "publishedYear": 2023
}

期待結果: 201 Created
検証項目:
- ステータスコード確認
- レスポンスボディの id 存在確認
- 作成日時の自動設定確認
```

#### 2. バリデーションエラーテスト
```
Method: POST
URL: http://localhost:8080/api/books
Headers: Content-Type: application/json
Body:
{
  "title": "",
  "author": "田中太郎"
}

期待結果: 400 Bad Request
検証項目:
- エラーメッセージの内容確認
- フィールド別エラー情報確認
```

---

## 次のステップ

1. **リポジトリテンプレート作成**
2. **Issue テンプレート設定**
3. **CI/CD パイプライン構築**
4. **レビューガイドライン作成**
5. **研修スケジュール詳細化**
