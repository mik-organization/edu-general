# リポジトリ設計案（MySQL版）- 主要変更箇所

## 技術スタック

### バックエンド
- **Java 17** + **Spring Boot 3.x**
- **Spring Data JPA** - データアクセス
- **MySQL 8.x** - メインデータベース
- **Spring Security** - 認証・認可
- **Spring Boot Test** - テスト

### 開発ツール
- **Gradle** - ビルドツール
- **Eclipse IDE** - 統合開発環境
- **JUnit 5** - テスト
- **Google Java Format** - コードフォーマット（Eclipseプラグイン）

---

## プロジェクト構成（MySQL用に変更）

### ルートディレクトリ構成
```
library-management-system/
├── src/
│   ├── main/
│   │   ├── java/
│   │   └── resources/
│   └── test/
├── sql/                     # データベース関連（dbフォルダから変更）
│   ├── ddl/
│   │   ├── 01_create_tables.sql
│   │   ├── 02_create_indexes.sql
│   │   └── 03_create_views.sql
│   ├── dml/
│   │   ├── 01_master_data.sql
│   │   ├── 02_test_data.sql
│   │   └── 03_sample_data.sql
│   └── init/
│       ├── init-db.sql
│       ├── backup.sql
│       └── cleanup.sql
├── gradle/
├── docs/
├── .gitignore
├── build.gradle
├── settings.gradle
├── gradlew
├── gradlew.bat
└── README.md
```

### 初期セットアップファイル

#### sql/init/init-db.sql
```sql
-- MySQL用初期化スクリプト
USE library_system;

-- 文字コード設定
SET NAMES utf8mb4;
SET CHARACTER SET utf8mb4;

-- タイムゾーン設定
SET time_zone = '+09:00';
```

#### sql/ddl/01_create_tables.sql（MySQL版）
```sql
-- MySQL用テーブル作成DDL
USE library_system;

-- 書籍テーブル
CREATE TABLE IF NOT EXISTS books (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    author VARCHAR(255) NOT NULL,
    isbn VARCHAR(13) UNIQUE,
    published_year INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 利用者テーブル
CREATE TABLE IF NOT EXISTS users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    phone VARCHAR(20),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- インデックス作成
CREATE INDEX idx_books_author ON books(author);
CREATE INDEX idx_books_published_year ON books(published_year);
CREATE INDEX idx_users_email ON users(email);
```

#### build.gradle（MySQL用）
```gradle
plugins {
    id 'java'
    id 'org.springframework.boot' version '3.2.0'
    id 'io.spring.dependency-management' version '1.1.4'
}

group = 'com.example'
version = '0.0.1-SNAPSHOT'

java {
    sourceCompatibility = '17'
}

repositories {
    mavenCentral()
}

dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-validation'
    implementation 'org.springframework.boot:spring-boot-starter-security'
    
    // MySQL Driver
    runtimeOnly 'com.mysql:mysql-connector-j'
    
    // Development
    developmentOnly 'org.springframework.boot:spring-boot-devtools'
    
    // Documentation
    implementation 'org.springdoc:springdoc-openapi-starter-webmvc-ui:2.2.0'
    
    // Testing
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testImplementation 'org.springframework.security:spring-security-test'
    testImplementation 'com.h2database:h2' // テスト用インメモリDB
    
    // Annotation Processing
    annotationProcessor 'org.springframework.boot:spring-boot-configuration-processor'
}

tasks.named('test') {
    useJUnitPlatform()
}
```

---

## 開発環境セットアップ手順（MySQL版）

### MySQL 環境構築（ローカルインストール）

#### データベース作成コマンド
```sql
-- MySQL Command Line Client で実行
mysql -u root -p

-- データベース作成
CREATE DATABASE library_system CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 開発用ユーザー作成
CREATE USER 'dev_user'@'localhost' IDENTIFIED BY 'dev_password';

-- 権限付与
GRANT ALL PRIVILEGES ON library_system.* TO 'dev_user'@'localhost';
FLUSH PRIVILEGES;

-- 確認
USE library_system;
SHOW TABLES;
```

#### 開発時の典型的な作業フロー（Windows PowerShell）
```powershell
# 1. MySQLサービス確認
Get-Service -Name MySQL*

# 2. サービスが停止している場合は起動
Start-Service -Name "MySQL80"

# 3. アプリケーション実行
.\gradlew.bat bootRun

# 4. データベースリセットが必要な場合
mysql -u root -p -e "DROP DATABASE IF EXISTS library_system; CREATE DATABASE library_system CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"
```

### application.yml 設定（MySQL版）
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/library_system?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=Asia/Tokyo&characterEncoding=UTF-8
    username: dev_user
    password: dev_password
    driver-class-name: com.mysql.cj.jdbc.Driver
  jpa:
    hibernate:
      ddl-auto: create-drop  # 開発時のみ
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
        format_sql: true
```

---

## Issue 設計の変更点（MySQL対応）

### Issue #2: MySQL データベース設定
**目的**: MySQL・JPA設定の理解
```
- MySQL データベース作成
- MySQL ユーザー作成と権限設定
- application.yml でデータベース接続設定
- JPA 設定（DDL auto, naming strategy等）
- 初期データ投入スクリプト（data.sql）作成
- 文字コード設定（UTF-8/utf8mb4）の確認
```

### Issue #33: デプロイメント設定・DB最適化（MySQL版）
**目的**: 本番環境・データベース最適化への理解
```
- アプリケーションのJAR化
- 環境別設定管理（dev/prod）
- MySQL パフォーマンス設定
- データベースインデックス設計
- MySQL特有の最適化（クエリキャッシュ、バッファプール等）
```

### Issue #37: 大量データ処理・DB最適化（MySQL版）
**目的**: MySQL 特有の機能・スケーラビリティの理解
```
- MySQL 特有機能活用（JSON型、Generated Columns等）
- バッチ処理実装
- ページング最適化（OFFSET/LIMIT最適化）
- パーティショニング設計
- EXPLAIN を使用したクエリ分析
- インデックスヒントの活用
```

---

## トラブルシューティング用コマンド（MySQL版）

```powershell
# MySQLサービス状態確認
Get-Service -Name MySQL*

# ポート使用状況確認（Windows）
netstat -an | findstr 3306

# MySQLプロセス確認
Get-Process -Name mysqld

# サービス再起動
Restart-Service -Name "MySQL80"
```

```sql
-- MySQL内での確認コマンド
-- 接続ユーザー確認
SELECT USER();

-- データベース一覧
SHOW DATABASES;

-- テーブル一覧
SHOW TABLES;

-- テーブル構造確認
DESCRIBE books;

-- 文字コード確認
SHOW VARIABLES LIKE 'character%';

-- プロセスリスト確認
SHOW PROCESSLIST;
```